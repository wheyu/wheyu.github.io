<!DOCTYPE html><html lang="zh-CN"><head><meta charset="UTF-8"><meta name="viewport"content="width=device-width, initial-scale=1.0"><title>文件文本替换工具</title><style>*{box-sizing:border-box;margin:0;padding:0;font-family:'Segoe UI',Tahoma,Geneva,Verdana,sans-serif}body{background-color:#f5f7fa;color:#333;line-height:1.6;padding:20px;max-width:900px;margin:0 auto}header{text-align:center;margin-bottom:30px;padding:20px;background:linear-gradient(135deg,#6e8efb,#a777e3);color:white;border-radius:10px;box-shadow:0 4px 6px rgba(0,0,0,0.1)}h1{font-size:2rem;margin-bottom:10px}.container{display:grid;gap:20px}.input-section,.files-section,.conditions-section{background:white;padding:20px;border-radius:10px;box-shadow:0 2px 10px rgba(0,0,0,0.08)}.form-group{margin-bottom:15px}label{display:block;margin-bottom:5px;font-weight:600;color:#555}input[type="text"]{width:100%;padding:10px;border:1px solid#ddd;border-radius:5px;font-size:16px}.drop-zone{border:2px dashed#6e8efb;border-radius:8px;padding:25px;text-align:center;cursor:pointer;transition:all 0.3s;background-color:rgba(110,142,251,0.05);margin-bottom:15px}.drop-zone:hover,.drop-zone.drag-over{background-color:rgba(110,142,251,0.15)}.file-count{text-align:center;margin-bottom:15px;font-weight:600;color:#6e8efb}.btn{background:linear-gradient(135deg,#6e8efb,#a777e3);color:white;border:none;padding:10px 15px;border-radius:6px;cursor:pointer;font-size:14px;font-weight:600;transition:all 0.3s}.btn:hover{transform:translateY(-2px);box-shadow:0 4px 8px rgba(0,0,0,0.15)}.btn:disabled{background:#ccc;cursor:not-allowed;transform:none;box-shadow:none}.btn-sm{padding:6px 10px;font-size:12px}.btn-danger{background:linear-gradient(135deg,#ff6b6b,#ee5a52)}.btn-success{background:linear-gradient(135deg,#1dd1a1,#10ac84)}.file-list{margin-top:15px;max-height:300px;overflow-y:auto}.file-item{display:flex;justify-content:space-between;align-items:center;padding:10px;background:#f8f9fa;border-radius:6px;margin-bottom:8px;border-left:4px solid#6e8efb}.file-name{font-weight:500;overflow:hidden;text-overflow:ellipsis;white-space:nowrap;flex:1}.file-status{font-size:12px;padding:4px 8px;border-radius:12px;margin-left:10px}.status-pending{background:#ffeeba;color:#856404}.status-completed{background:#c3e6cb;color:#155724}.conditions-list{margin-top:15px;display:flex;flex-wrap:wrap;gap:5px}.condition-item{display:flex;align-items:center;padding:5px;background:#f8f9fa;border:solid 1px#ddd;border-radius:6px;margin-bottom:10px;gap:4px}.condition-pattern{flex:1;font-family:monospace;padding-left:4px;padding-right:8px;font-size:1rem;font-weight:600}.condition-negate{display:flex;align-items:center;white-space:nowrap}.condition-actions{display:flex;gap:5px}.drag-handle{cursor:move;padding:5px;color:#6c757d}.notification{position:fixed;top:20px;right:20px;padding:15px 20px;border-radius:6px;color:white;opacity:0;transform:translateX(100%);transition:all 0.3s;z-index:1000}.notification.show{opacity:1;transform:translateX(0)}.notification.success{background:#28a745}.notification.error{background:#dc3545}.empty-message{text-align:center;color:#6c757d;padding:20px}.regex-help{font-size:12px;color:#6c757d;margin-top:5px}.section-title{display:flex;justify-content:space-between;align-items:center;margin-bottom:15px}.toggle-btn{background:none;border:none;color:#6e8efb;cursor:pointer;font-size:14px}.condition-type{font-size:12px;padding:2px 6px;border-radius:4px;background:#e9ecef;cursor:default}.type-include{background:#d4edda;color:#155724}.type-exclude{background:#f8d7da;color:#721c24}</style></head><body><header><h1>文件文本替换工具</h1><p>拖入多个文件，按正则条件筛选行并替换文本内容</p></header><div class="container"><div class="conditions-section"><div class="section-title"><h2>行筛选条件（正则）</h2><button class="toggle-btn"id="toggleHelp">说明</button></div><div class="form-group"id="helpText"style="display: none;"><p>首先使用正则条件筛选行，然后在匹配的行中进行文本替换：</p><ol><li>添加正则表达式来筛选符合条件的行</li><li>选择"包含"或"排除"模式</li><li>在下方设置要查找和替换的文本</li><li>只有符合筛选条件的行才会进行文本替换</li></ol></div><div class="form-group"><label for="newCondition">新筛选条件（正则表达式）：</label><input type="text"id="newCondition"placeholder="输入正则表达式模式"><!--<div class="regex-help">例如：^error|warning$或\d{3,}</div>--></div><div class="form-group"><label for="negateCondition"><input type="checkbox"id="negateCondition">排除匹配的行（取反）</label></div><button class="btn"id="addConditionBtn">添加条件</button><div class="conditions-list"id="conditionsList"><div class="empty-message">暂无筛选条件，所有行都将被处理</div></div></div><div class="input-section"><h2>文本替换设置</h2><div class="form-group"><label for="matchText">查找文本：</label><input type="text"id="matchText"placeholder="输入要查找的文本"></div><div class="form-group"><label for="replaceText">替换文本：</label><input type="text"id="replaceText"placeholder="输入要替换成的文本"></div><div class="drop-zone"id="dropZone"><p>📁拖放文件到此处，或<strong>点击选择文件</strong></p><p class="file-count"id="fileCount">已选择0个文件</p></div><button class="btn"id="processBtn"disabled>处理文件</button><button class="btn btn-success"style="margin-left: 8px;"id="downloadBtn"disabled>打包下载所有文件</button></div><div class="files-section"><h2>文件列表</h2><div class="file-list"id="fileList"><div class="empty-message">暂无文件，请拖放或选择文件</div></div></div></div><div class="notification"id="notification"></div><script>document.addEventListener('DOMContentLoaded',function(){const dropZone=document.getElementById('dropZone');const fileInput=document.createElement('input');fileInput.type='file';fileInput.multiple=true;fileInput.style.display='none';document.body.appendChild(fileInput);const processBtn=document.getElementById('processBtn');const downloadBtn=document.getElementById('downloadBtn');const fileList=document.getElementById('fileList');const fileCount=document.getElementById('fileCount');const matchText=document.getElementById('matchText');const replaceText=document.getElementById('replaceText');const notification=document.getElementById('notification');const conditionsList=document.getElementById('conditionsList');const addConditionBtn=document.getElementById('addConditionBtn');const newCondition=document.getElementById('newCondition');const negateCondition=document.getElementById('negateCondition');const toggleHelp=document.getElementById('toggleHelp');const helpText=document.getElementById('helpText');let files=[];let processedFiles=[];let conditions=[];dropZone.addEventListener('click',()=>{fileInput.click()});fileInput.addEventListener('change',(e)=>{handleFiles(e.target.files);fileInput.value=''});dropZone.addEventListener('dragover',(e)=>{e.preventDefault();dropZone.classList.add('drag-over')});dropZone.addEventListener('dragleave',()=>{dropZone.classList.remove('drag-over')});dropZone.addEventListener('drop',(e)=>{e.preventDefault();dropZone.classList.remove('drag-over');handleFiles(e.dataTransfer.files)});processBtn.addEventListener('click',processFiles);downloadBtn.addEventListener('click',downloadAllFiles);addConditionBtn.addEventListener('click',addCondition);toggleHelp.addEventListener('click',()=>{helpText.style.display=helpText.style.display==='none'?'block':'none'});function showNotification(message,isSuccess=true){notification.textContent=message;notification.className='notification '+(isSuccess?'success':'error');notification.classList.add('show');setTimeout(()=>{notification.classList.remove('show')},3000)}function addCondition(){const pattern=newCondition.value.trim();if(!pattern){showNotification('请输入正则表达式',false);return}try{new RegExp(pattern)}catch(e){showNotification('无效的正则表达式: '+e.message,false);return}conditions.push({pattern:pattern,negate:negateCondition.checked});updateConditionsList();newCondition.value='';negateCondition.checked=false}function removeCondition(index){conditions.splice(index,1);updateConditionsList()}function updateConditionsList(){conditionsList.innerHTML='';if(conditions.length===0){conditionsList.innerHTML='<div class="empty-message">暂无筛选条件，所有行都将被处理</div>';return}conditions.forEach((condition,index)=>{const conditionItem=document.createElement('div');conditionItem.className='condition-item';const patternText=document.createElement('div');patternText.className='condition-pattern';patternText.textContent=condition.pattern;const conditionType=document.createElement('div');conditionType.className=`condition-type ${condition.negate?'type-exclude':'type-include'}`;conditionType.textContent=condition.negate?'排除':'包含';const actions=document.createElement('div');actions.className='condition-actions';const deleteBtn=document.createElement('button');deleteBtn.className='btn btn-sm btn-danger';deleteBtn.textContent='删除';deleteBtn.addEventListener('click',()=>removeCondition(index));actions.appendChild(deleteBtn);conditionItem.appendChild(patternText);conditionItem.appendChild(conditionType);conditionItem.appendChild(actions);conditionsList.appendChild(conditionItem)})}function handleFiles(newFiles){if(newFiles.length===0)return;for(let i=0;i<newFiles.length;i++){const file=newFiles[i];if(files.some(f=>f.name===file.name&&f.size===file.size)){continue}files.push(file)}updateFileList()}function updateFileList(){fileList.innerHTML='';fileCount.textContent=`已选择${files.length}个文件`;if(files.length===0){fileList.innerHTML='<div class="empty-message">暂无文件，请拖放或选择文件</div>';processBtn.disabled=true;downloadBtn.disabled=true;return}processBtn.disabled=false;files.forEach(file=>{const fileItem=document.createElement('div');fileItem.className='file-item';const fileName=document.createElement('div');fileName.className='file-name';fileName.textContent=file.name;const fileStatus=document.createElement('span');fileStatus.className='file-status status-pending';fileStatus.textContent='等待处理';fileItem.appendChild(fileName);fileItem.appendChild(fileStatus);fileList.appendChild(fileItem)})}function lineMatchesConditions(line){if(conditions.length===0)return true;for(const condition of conditions){try{const regex=new RegExp(condition.pattern);const matches=regex.test(line);if(condition.negate){if(matches)return false}else{if(!matches)return false}}catch(e){console.error('无效的正则表达式:',condition.pattern,e);continue}}return true}function processFiles(){const match=matchText.value;const replace=replaceText.value;if(!match){showNotification('请输入要查找的文本',false);return}if(files.length===0){showNotification('请添加至少一个文件',false);return}processedFiles=[];let processedCount=0;files.forEach((file,index)=>{const fileItems=document.querySelectorAll('.file-item');const fileStatus=fileItems[index].querySelector('.file-status');fileStatus.textContent='处理中...';fileStatus.className='file-status status-pending';const reader=new FileReader();reader.onload=function(e){try{let content=e.target.result;let newContent;const lines=content.split('\n');const processedLines=lines.map(line=>{if(lineMatchesConditions(line)){return line.replace(new RegExp(match,'g'),replace)}return line});newContent=processedLines.join('\n');const newFile=new Blob([newContent],{type:file.type});processedFiles.push({original:file,processed:newFile,name:file.name});fileStatus.textContent='处理完成';fileStatus.className='file-status status-completed';processedCount++;if(processedCount===files.length){downloadBtn.disabled=false;showNotification('所有文件处理完成！')}}catch(error){fileStatus.textContent='处理失败';fileStatus.className='file-status status-pending';console.error('文件处理错误:',error);processedCount++}};reader.onerror=function(){fileStatus.textContent='读取失败';fileStatus.className='file-status status-pending';processedCount++};reader.readAsText(file)})}function downloadAllFiles(){if(processedFiles.length===0){showNotification('没有可下载的文件',false);return}if(processedFiles.length===1){const file=processedFiles[0];const url=URL.createObjectURL(file.processed);const a=document.createElement('a');a.href=url;a.download=file.name;document.body.appendChild(a);a.click();document.body.removeChild(a);URL.revokeObjectURL(url);showNotification('文件下载完成！');return}function createZip(files,callback){const zipParts=[];const centralDirectory=[];let offset=0;const processNextFile=(index)=>{if(index>=files.length){const zipContent=zipParts.join('')+centralDirectory.join('')+`PK\x05\x06\x00\x00\x00\x00`+String.fromCharCode(files.length&0xff)+String.fromCharCode((files.length>>8)&0xff)+String.fromCharCode(files.length&0xff)+String.fromCharCode((files.length>>8)&0xff)+String.fromCharCode(offset&0xff)+String.fromCharCode((offset>>8)&0xff)+String.fromCharCode((offset>>16)&0xff)+String.fromCharCode((offset>>24)&0xff)+String.fromCharCode(centralDirectory.join('').length&0xff)+String.fromCharCode((centralDirectory.join('').length>>8)&0xff)+String.fromCharCode((centralDirectory.join('').length>>16)&0xff)+String.fromCharCode((centralDirectory.join('').length>>24)&0xff)+'\x00\x00';const zipBlob=new Blob([zipContent],{type:'application/zip'});callback(zipBlob);return}const file=files[index];const reader=new FileReader();reader.onload=function(e){const content=e.target.result;const fileName=file.name;const localHeader=`PK\x03\x04\x14\x00\x00\x00\x00\x00\x00\x00\x00\x00`;const nameLength=fileName.length;const contentLength=content.length;const entry=localHeader+String.fromCharCode(contentLength&0xff)+String.fromCharCode((contentLength>>8)&0xff)+String.fromCharCode((contentLength>>16)&0xff)+String.fromCharCode((contentLength>>24)&0xff)+String.fromCharCode(contentLength&0xff)+String.fromCharCode((contentLength>>8)&0xff)+String.fromCharCode((contentLength>>16)&0xff)+String.fromCharCode((contentLength>>24)&0xff)+String.fromCharCode(nameLength&0xff)+String.fromCharCode((nameLength>>8)&0xff)+'\x00\x00'+fileName+content;zipParts.push(entry);const centralRecord=`PK\x01\x02\x14\x00\x14\x00\x00\x00\x00\x00\x00\x00\x00\x00`+String.fromCharCode(contentLength&0xff)+String.fromCharCode((contentLength>>8)&0xff)+String.fromCharCode((contentLength>>16)&0xff)+String.fromCharCode((contentLength>>24)&0xff)+String.fromCharCode(contentLength&0xff)+String.fromCharCode((contentLength>>8)&0xff)+String.fromCharCode((contentLength>>16)&0xff)+String.fromCharCode((contentLength>>24)&0xff)+String.fromCharCode(nameLength&0xff)+String.fromCharCode((nameLength>>8)&0xff)+'\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00'+String.fromCharCode(offset&0xff)+String.fromCharCode((offset>>8)&0xff)+String.fromCharCode((offset>>16)&0xff)+String.fromCharCode((offset>>24)&0xff)+fileName;centralDirectory.push(centralRecord);offset+=entry.length;processNextFile(index+1)};reader.readAsText(file.processed)};processNextFile(0)}createZip(processedFiles,function(zipBlob){const url=URL.createObjectURL(zipBlob);const a=document.createElement('a');a.href=url;a.download='processed_files.zip';document.body.appendChild(a);a.click();document.body.removeChild(a);URL.revokeObjectURL(url);showNotification('文件打包下载完成！')})}updateConditionsList()});</script></body></html>